<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebGPU Color Fade</title>
  <style>canvas { width: 100vw; height: 100vh; display: block; }</style>
</head>
<body>
<canvas id="gpu-canvas"></canvas>
<script type="module">
  async function initWebGPU() {
    if (!navigator.gpu) {
      alert("WebGPU not supported.");
      return;
    }

    const canvas = document.getElementById("gpu-canvas");
    const adapter = await navigator.gpu.requestAdapter();
    const device = await adapter.requestDevice();
    const context = canvas.getContext("webgpu");

    const format = navigator.gpu.getPreferredCanvasFormat();
    context.configure({
      device: device,
      format: format,
      alphaMode: "opaque"
    });

    let t = 0;
    function frame() {
      // 用时间周期变化生成颜色
      const r = 0.5 + 0.5 * Math.sin(t);
      const g = 0.5 + 0.5 * Math.sin(t + 2);
      const b = 0.5 + 0.5 * Math.sin(t + 4);
      t += 0.02;

      const encoder = device.createCommandEncoder();
      const view = context.getCurrentTexture().createView();

      const pass = encoder.beginRenderPass({
        colorAttachments: [{
          view: view,
          clearValue: { r, g, b, a: 1 },
          loadOp: "clear",
          storeOp: "store",
        }]
      });

      pass.end();
      device.queue.submit([encoder.finish()]);
      requestAnimationFrame(frame);
    }

    frame();
  }

  initWebGPU();
</script>
</body>
</html>
